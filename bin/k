#!/usr/bin/env zsh

# setup PATH
K_RELEASE="$SRC/k/$K_VERSION/k-distribution/target/release/k"
k_path="$K_RELEASE/lib/native/linux"
k_path="$k_path:$K_RELEASE/lib/native/linux64"
k_path="$k_path:$K_RELEASE/bin"
export PATH="$PATH:$k_path"

# setup LD_LIBRARY_PATH
k_ld_library_path="$K_RELEASE/lib/native/linux64"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$k_ld_library_path"

# setup OCaml for RV-K
[[ "$K_VERSION" == 'rvk' ]] && eval `opam config env`

kcommand="$1" && shift
case "$kcommand" in
    run)   krun    $@ ;;
    build) kompile $@ ;;
    *)     echo "Unsupported K command: '$kcommand'..." && exit 1
esac
